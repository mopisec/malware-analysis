# Analysis Note

My personal note describing the process and results of LODEINFO v0.6.5 analysis.

## Table of Contents

- [How it builds User-Agent string for C2 communication](#how-it-builds-user-agent-string-for-c2-communication)
- [Collecting the information of the system](#collecting-the-information-of-the-system)
- [Checking if locale is "en-US"](#checking-if-locale-is-en-us)
- [Persistence](#persistence)

## How it builds User-Agent string for C2 communication

LODEINFO will look for Google Chrome installed on the system, by examining following 3 paths.

- `C:\Program Files (x86)\Google\Chrome\Application\chrome.exe`
- `C:\Program Files\Google\Chrome\Application\chrome.exe`
- `C:\Users\Administrator\AppData\Local\Google\Chrome\Application\chrome.exe`

If `chrome.exe` is found, LODEINFO will use its version in User-Agent string.

```
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/[CHROME_VERSION_HERE] Safari/537.36
```

And if its not found, it will use `98.0.4758.102` as a Google Chrome version inside the User-Agent string.

```
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36
```

## Collecting the information of the system

LODEINFO will collect the information of the system first, and build a string containing them.
Following is the format of its string, and detail of each field.

```
[Value based on time]|[ACP Identifier]|[MAC Address]|[Computer Name]#[(Possible) Campaign ID or Key]-[LODEINFO Version]
```

### Value based on time

Value here will be calculated using current system date and time (UTC), which is collected via `GetSystemTimeAsFileTime` function.
`GetSystemTimeAsFileTime` function will pass FILETIME structure as an output, that has 2 DWORD member `dwLowDateTime` and `dwHighDateTime`.
LODEINFO will use those 2 DWORD to calculate some value based on it.
Following python function is identical to the procedure of value calculation.

```py
def calc_value_from_filetime(dwLowDateTime: int, dwHighDateTime: int) -> int:
    ecx = 0x989680
    edx = dwHighDateTime % ecx
    tmp = unpack('<Q', pack('<I', dwLowDateTime) + pack('<I', edx))[0]
    return ((tmp // ecx) + 0x49EF6F00) & 0xFFFFFFFF
```

### ACP Identifier

ACP identifier collected via `GetACP` function.

### MAC Address

LODEINFO will collect MAC address of the network interface that meets the following conditions.

- IPv4 is enabled
- It is ethernet network interface (`IF_TYPE_ETHERNET_CSMACD`) or IEEE 802.11 wireless network interface (`IF_TYPE_IEEE80211`)
- Description of adapter does not contain `Virtual`

Address will be formatted with `%02X%02X%02X%02X%02X%02X`, so if MAC address is `00-11-22-33-44-55`, formatted string will be `001122334455`.

### Computer Name

Computer name collected via `GetComputerNameA` function.

### Possible Campaign ID or Key

TBD

### LODEINFO Version (v0.6.5)

Hardcoded version value of LODEINFO.

## Checking if locale is "en-US"

Before starting any malicious activity, LODEINFO will check default locale of the operating system.
If locale was `en-US`, it will not continue further on.

## Persistence

LODEINFO will first attempt to create and write a registry key at `HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run` for persistence.
When it fails, it will attempt to create and write at `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`.

Registry value name will be the filename of the executable (without `.exe`) that loaded the LODEINFO shellcode, and data stored there will be the full path of that executable.
