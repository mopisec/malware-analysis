import glob, json, os, pefile, pickle

DLL_SEARCH_DIR = b'C:\\Windows\\SysWOW64\\'

# ref: https://gist.github.com/trietptm/5cd60ed6add5adad6a34098ce255949a#file-rol-ror-py-L13
ror = lambda val, r_bits, max_bits: \
    ((val & (2**max_bits-1)) >> r_bits%max_bits) | \
    (val << (max_bits-(r_bits%max_bits)) & (2**max_bits-1))

def hash_dll(data, hash_value):
    for char in data:
        if char >= 0x41 and char <= 0x5A:
            char |= 0x20
        hash_value = (char + ror(hash_value, 13, 32)) & 0xFFFFFFFF
    return hash_value

def main():
    result = {}
    dll_path_list = [p for p in glob.glob(DLL_SEARCH_DIR + b'*.dll')]
    for dll_path in dll_path_list:
        dll_filename = os.path.basename(dll_path)
        dll_hash = hash_dll(dll_filename + b'\x00', 0)
        result[dll_hash] = dll_filename.decode()
    with open('dll_hash_dict.json', 'w') as result_file:
        json.dump(result, result_file)

if __name__ == '__main__':
    main()